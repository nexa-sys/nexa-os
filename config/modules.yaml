# NexaOS Kernel Modules Trimming Configuration
#
# This file controls which modules are enabled/disabled for each build profile.
# Module metadata (type, description, dependencies, config) is defined in each
# module's Cargo.toml under [package.metadata.nexaos].
#
# The build system auto-discovers modules from modules/Cargo.toml workspace,
# then applies this trimming configuration to determine which modules to build.
#
# See modules/Cargo.toml for the workspace definition and individual module
# Cargo.toml files for module-specific metadata.

# =============================================================================
# Module Enable/Disable Configuration
# =============================================================================
# Set to true to enable, false to disable
# Modules not listed here default to enabled if present in workspace

modules:
  # Filesystem drivers
  ext2:
    enabled: true
  ext3:
    enabled: true
  ext4:
    enabled: true

  # Block device drivers
  virtio_blk:
    enabled: true
  ide:
    enabled: true
  ahci:
    enabled: true

  # Memory management
  swap:
    enabled: true

  # Network drivers
  e1000:
    enabled: true
  virtio_net:
    enabled: false    # Not yet implemented

# =============================================================================
# Module Loading Configuration
# =============================================================================
# Settings for automatic module loading at boot

autoload:
  # Modules to load during initramfs phase (before root pivot)
  initramfs:
    - virtio_blk      # Need block device access
    - ext2            # Need filesystem to mount root
    - ext4            # ext4 filesystem support
  
  # Modules to load after root pivot
  rootfs:
    - e1000           # Network driver
    - swap            # Swap support (if enabled)

# =============================================================================
# Module Signing Configuration
# =============================================================================
signing:
  # Require all modules to be signed
  required: true
  
  # Path to signing certificate
  certificate: certs/signing_key.x509
  
  # Path to signing key
  private_key: certs/signing_key.der
  
  # Signing algorithm
  algorithm: sha256

# =============================================================================
# Build Profile Overrides
# =============================================================================
# Override module settings per build profile (referenced from config/build.yaml)

profiles:
  # Minimal profile - only essential modules
  minimal:
    enabled:
      - ext2
      - virtio_blk
    disabled:
      - ext3
      - ext4
      - ide
      - swap
      - e1000
      - virtio_net

  # Server profile - no swap compression, optimized for throughput
  server:
    enabled:
      - ext2
      - ext3
      - ext4
      - virtio_blk
      - ahci
      - e1000
      - swap
    disabled:
      - ide           # VirtIO preferred for servers
      - virtio_net

  # Desktop profile - full driver support
  desktop:
    enabled:
      - ext2
      - ext3
      - ext4
      - virtio_blk
      - ide
      - ahci
      - e1000
      - swap
    disabled:
      - virtio_net

  # Default profile - same as desktop
  default:
    enabled:
      - ext2
      - ext3
      - ext4
      - virtio_blk
      - ide
      - ahci
      - e1000
      - swap
    disabled:
      - virtio_net
