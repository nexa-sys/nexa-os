# NexaOS TypeScript Build System

ç”¨ TypeScript é‡å†™çš„ NexaOS æ„å»ºç³»ç»Ÿï¼Œæä¾›æ›´å¥½çš„ç±»å‹å®‰å…¨ã€å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

## ç‰¹æ€§

- ğŸš€ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- ğŸ“¦ **æ¨¡å—åŒ–** - æ¯ä¸ªæ„å»ºæ­¥éª¤ç‹¬ç«‹æ¨¡å—
- ğŸ¨ **ç¾è§‚è¾“å‡º** - å½©è‰²æ—¥å¿—ã€è¿›åº¦æ¡ã€spinner
- âš¡ **å¹¶è¡Œæ„å»º** - æ”¯æŒå¹¶è¡Œæ‰§è¡Œç‹¬ç«‹ä»»åŠ¡
- ğŸ“‹ **YAML é…ç½®** - ä½¿ç”¨ç°æœ‰çš„ `build-config.yaml`
- ğŸ”§ **çµæ´»** - æ”¯æŒå•ç‹¬æ„å»ºä»»ä½•ç»„ä»¶

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
cd scripts-ts
npm install
```

### å¼€å‘æ¨¡å¼

ä½¿ç”¨ `tsx` ç›´æ¥è¿è¡Œ TypeScriptï¼š

```bash
npm run dev -- full        # å®Œæ•´æ„å»º
npm run dev -- quick       # å¿«é€Ÿæ„å»º
npm run dev -- kernel      # ä»…æ„å»ºå†…æ ¸
```

æˆ–ä½¿ç”¨ wrapper è„šæœ¬ï¼š

```bash
./scripts/build-ts.sh full
./scripts/build-ts.sh kernel
```

### ç¼–è¯‘ç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build              # ç¼–è¯‘ TypeScript
node dist/cli.js full      # è¿è¡Œç¼–è¯‘åçš„ç‰ˆæœ¬
```

## å‘½ä»¤

| å‘½ä»¤ | åˆ«å | æè¿° |
|------|------|------|
| `full` | `all` | å®Œæ•´ç³»ç»Ÿæ„å»º |
| `quick` | `q` | å¿«é€Ÿæ„å»ºï¼ˆkernel + initramfs + ISOï¼‰ |
| `kernel` | `k` | ä»…æ„å»ºå†…æ ¸ |
| `userspace` | `u` | æ„å»ºç”¨æˆ·ç©ºé—´ç¨‹åº |
| `libs` | `l` | æ„å»ºåº“ |
| `modules` | `m` | æ„å»ºå†…æ ¸æ¨¡å— |
| `programs` | `p` | æ„å»ºç”¨æˆ·ç¨‹åº |
| `initramfs` | `i` | æ„å»º initramfs |
| `rootfs` | `r` | æ„å»ºæ ¹æ–‡ä»¶ç³»ç»Ÿ |
| `iso` | - | æ„å»º ISO é•œåƒ |
| `clean` | - | æ¸…ç†æ„å»ºäº§ç‰© |
| `list` | - | åˆ—å‡ºå¯ç”¨ç›®æ ‡ |
| `info` | - | æ˜¾ç¤ºæ„å»ºç¯å¢ƒä¿¡æ¯ |

### é€‰é¡¹

```bash
# æ„å»ºç‰¹å®šç¨‹åº
npm run dev -- programs --name sh

# æ„å»ºç‰¹å®šåº“
npm run dev -- libs --name nssl

# æ„å»ºç‰¹å®šæ¨¡å—
npm run dev -- modules --name ext2

# åˆ—å‡ºæ‰€æœ‰å¯ç”¨ç¨‹åº
npm run dev -- programs --list

# åˆ—å‡ºæ‰€æœ‰ç›®æ ‡
npm run dev -- list

# ä»…æ¸…ç† build/ ç›®å½•
npm run dev -- clean --build-only

# è¿è¡Œå¤šä¸ªæ­¥éª¤
npm run dev -- run kernel initramfs iso
```

## ç¯å¢ƒå˜é‡

| å˜é‡ | é»˜è®¤å€¼ | æè¿° |
|------|--------|------|
| `BUILD_TYPE` | `debug` | æ„å»ºç±»å‹ (debug/release) |
| `LOG_LEVEL` | `debug` | å†…æ ¸æ—¥å¿—çº§åˆ« |
| `ROOTFS_SIZE_MB` | `50` | æ ¹æ–‡ä»¶ç³»ç»Ÿå¤§å° (MB) |

## é¡¹ç›®ç»“æ„

```
scripts-ts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli.ts           # å‘½ä»¤è¡Œæ¥å£
â”‚   â”œâ”€â”€ builder.ts       # ä¸»æ„å»ºå™¨
â”‚   â”œâ”€â”€ types.ts         # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ config.ts        # YAML é…ç½®è§£æ
â”‚   â”œâ”€â”€ env.ts           # æ„å»ºç¯å¢ƒ
â”‚   â”œâ”€â”€ logger.ts        # æ—¥å¿—è¾“å‡º
â”‚   â”œâ”€â”€ exec.ts          # å‘½ä»¤æ‰§è¡Œ
â”‚   â””â”€â”€ steps/           # æ„å»ºæ­¥éª¤
â”‚       â”œâ”€â”€ kernel.ts    # å†…æ ¸æ„å»º
â”‚       â”œâ”€â”€ nrlib.ts     # nrlib æ„å»º
â”‚       â”œâ”€â”€ libs.ts      # åº“æ„å»º
â”‚       â”œâ”€â”€ programs.ts  # ç¨‹åºæ„å»º
â”‚       â”œâ”€â”€ modules.ts   # æ¨¡å—æ„å»º
â”‚       â”œâ”€â”€ rootfs.ts    # rootfs æ„å»º
â”‚       â”œâ”€â”€ initramfs.ts # initramfs æ„å»º
â”‚       â”œâ”€â”€ iso.ts       # ISO æ„å»º
â”‚       â”œâ”€â”€ uefi.ts      # UEFI loader æ„å»º
â”‚       â””â”€â”€ clean.ts     # æ¸…ç†
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## ä¸ Shell è„šæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§ | Shell è„šæœ¬ | TypeScript |
|------|------------|------------|
| ç±»å‹æ£€æŸ¥ | âŒ | âœ… |
| IDE æ”¯æŒ | åŸºç¡€ | å®Œæ•´ |
| é”™è¯¯å¤„ç† | åŸºç¡€ | ç»“æ„åŒ– |
| é…ç½®è§£æ | æ‰‹åŠ¨æ­£åˆ™ | YAML åº“ |
| å¹¶è¡Œæ„å»º | å›°éš¾ | ç®€å• |
| æµ‹è¯• | å›°éš¾ | ç®€å• |
| å¯ç»´æŠ¤æ€§ | ä¸­ç­‰ | é«˜ |

## æ‰©å±•

### æ·»åŠ æ–°çš„æ„å»ºæ­¥éª¤

1. åœ¨ `src/steps/` åˆ›å»ºæ–°æ–‡ä»¶
2. å¯¼å‡ºæ„å»ºå‡½æ•°
3. åœ¨ `src/steps/index.ts` æ·»åŠ å¯¼å‡º
4. åœ¨ `src/builder.ts` æ·»åŠ æ–¹æ³•
5. åœ¨ `src/cli.ts` æ·»åŠ å‘½ä»¤

### æ·»åŠ æ–°çš„ç¨‹åº/æ¨¡å—/åº“

ç›´æ¥åœ¨ `scripts/build-config.yaml` ä¸­æ·»åŠ é…ç½®å³å¯ï¼Œæ„å»ºç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ã€‚

## ä¾èµ–

- Node.js 20+
- npm æˆ– yarn
- Rust å·¥å…·é“¾
- æ ‡å‡† Linux æ„å»ºå·¥å…· (gcc, make, etc.)
